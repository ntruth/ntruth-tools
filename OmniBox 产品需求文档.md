

**版本**：v2.0  
**更新日期**：2025年12月3日

---

## 一、产品概述

### 1.1 产品定位

OmniBox 是一款跨平台（macOS/Windows）的高效启动器与生产力工具，集成快速搜索、剪贴板管理、截图标注、AI 助手、工作流自动化及插件扩展能力，旨在成为用户桌面端的统一入口。

### 1.2 目标用户

- 开发者、设计师、知识工作者
- 追求效率的高级用户
- 需要频繁进行文件搜索、剪贴板操作、截图标注的用户

### 1.3 核心价值

| 价值点 | 描述 |
|--------|------|
| **快速访问** | 全局快捷键一键唤起，毫秒级响应 |
| **统一入口** | 搜索、AI、剪贴板、截图、工作流统一管理 |
| **本地优先** | 数据本地存储，隐私安全 |
| **高度可定制** | 插件系统 + 工作流 + 自定义配置 |

---

## 二、功能模块

### 2.1 核心搜索

#### 2.1.1 搜索能力

| 搜索类型     | 触发方式       | 说明             |
| -------- | ---------- | -------------- |
| 文件搜索     | 直接输入       | 本地文件名模糊匹配      |
| 应用搜索     | 直接输入       | 已安装应用快速启动      |
| 计算器      | `=` 或数学表达式 | 支持基础运算、函数、单位换算 |
| AI 问答    | `ai ` 前缀   | 调用配置的 AI 服务    |
| 剪贴板搜索    | `cb ` 前缀   | 搜索剪贴板历史        |
| 书签搜索     | `bm ` 前缀   | 搜索浏览器书签        |
| 系统命令     | `> ` 前缀    | 执行系统命令         |
| Web 搜索   | `关键词 查询`   | 使用指定搜索引擎搜索     |
| 直接打开 URL | 输入网址       | 自动识别并打开        |

#### 2.1.2 Web 搜索引擎

**内置搜索引擎：**

| 关键词     | 搜索引擎           | URL 模板                                                 |
| ------- | -------------- | ------------------------------------------------------ |
| `gg`    | Google         | `https://www.google.com/search?q={query}`              |
| `bd`    | Baidu          | `https://www.baidu.com/s?wd={query}`                   |
| `bi`    | Bing           | `https://www.bing.com/search?q={query}`                |
| `ddg`   | DuckDuckGo     | `https://duckduckgo.com/?q={query}`                    |
| `gh`    | GitHub         | `https://github.com/search?q={query}`                  |
| `so`    | Stack Overflow | `https://stackoverflow.com/search?q={query}`           |
| `yt`    | YouTube        | `https://www.youtube.com/results?search_query={query}` |
| `tw`    | Twitter/X      | `https://twitter.com/search?q={query}`                 |
| `npm`   | NPM            | `https://www.npmjs.com/search?q={query}`               |
| `crate` | Crates.io      | `https://crates.io/search?q={query}`                   |

**使用示例：**
- `gg rust programming` → 使用 Google 搜索 "rust programming"
- `gh tauri` → 在 GitHub 搜索 "tauri"
- `gg www.baidu.com` → 使用 Google 搜索 "www.baidu.com"

**自定义搜索引擎：**
- 用户可在配置中心添加自定义搜索引擎
- 支持自定义关键词、名称、URL 模板、图标

#### 2.1.3 文件索引

- **索引范围**：可配置的目录列表
- **排除规则**：支持路径排除、扩展名排除、glob 模式
- **索引方式**：前缀树 + Trigram 索引，支持模糊匹配
- **增量更新**：文件系统监听，实时更新索引
- **权重排序**：结合使用频率、最近访问时间、匹配度综合排序

#### 2.1.4 搜索过滤器

| 过滤器 | 语法 | 示例 |
|--------|------|------|
| 扩展名 | `.ext` | `report .pdf` |
| 路径 | `path:keyword` | `path:Documents` |
| 大小 | `size:>10mb` | `size:<1gb` |
| 修改时间 | `modified:7d` | `modified:2024-01` |

---

### 2.2 剪贴板管理

#### 2.2.1 功能特性

| 特性        | 说明               |
| --------- | ---------------- |
| **独立窗口**  | 通过快捷键独立唤起剪贴板历史窗口 |
| **多类型支持** | 文本、富文本、图片、文件、颜色值 |
| **智能预览**  | 根据内容类型显示预览       |
| **快速粘贴**  | 选择后自动粘贴到当前应用     |
| **收藏功能**  | 常用内容收藏，永久保存      |
| **来源追踪**  | 记录复制来源应用         |
| **敏感过滤**  | 自动过滤密码等敏感内容      |
| **应用过滤**  | 可配置忽略特定应用的复制     |

#### 2.2.2 快捷键操作

| 快捷键 | 操作 |
|--------|------|
| `Cmd/Ctrl+Shift+V` | 唤起剪贴板历史窗口 |
| `1-9` | 快速选择并粘贴对应条目 |
| `↑/↓` | 上下选择 |
| `Enter` | 粘贴选中项 |
| `Cmd/Ctrl+Delete` | 删除选中项 |
| `Cmd/Ctrl+S` | 收藏/取消收藏 |
| `Esc` | 关闭窗口 |

#### 2.2.3 配置选项

- 历史记录数量上限（默认 1000）
- 单条记录最大尺寸
- 保留天数
- 忽略应用列表
- 敏感内容正则匹配规则
- 是否存储图片

---

### 2.3 截图与贴图

#### 2.3.1 截图模式

| 模式 | 快捷键 | 说明 |
|------|--------|------|
| 区域截图 | `Cmd/Ctrl+Shift+4` | 框选区域截图，进入标注编辑器 |
| 窗口截图 | `Cmd/Ctrl+Shift+5` | 选择窗口截图 |
| 全屏截图 | `Cmd/Ctrl+Shift+3` | 截取整个屏幕 |
| 延时截图 | 编辑器内选择 | 3/5/10 秒延时 |
| 快速贴图 | `Cmd/Ctrl+Shift+P` | 截图后直接贴图，不进入编辑器 |
| 取色器 | `Cmd/Ctrl+Shift+C` | 屏幕取色 |

#### 2.3.2 标注工具

| 工具  | 图标  | 说明      |
| --- | --- | ------- |
| 选择  | ↖   | 选择/移动标注 |
| 矩形  | □   | 绘制矩形框   |
| 椭圆  | ○   | 绘制椭圆/圆形 |
| 箭头  | →   | 绘制箭头    |
| 直线  | ╱   | 绘制直线    |
| 画笔  | ✏   | 自由绘制    |
| 文字  | T   | 添加文字标注  |
| 马赛克 | ▦   | 区域马赛克   |
| 序号  | ①   | 添加序号标记  |

#### 2.3.3 贴图功能

| 特性 | 说明 |
|------|------|
| 悬浮显示 | 始终置顶显示 |
| 透明度调节 | 滚轮调节透明度 |
| 缩放 | Cmd/Ctrl + 滚轮缩放 |
| 穿透点击 | 可设置鼠标穿透 |
| 多贴图 | 支持同时多个贴图窗口 |

#### 2.3.4 输出选项

- 复制到剪贴板
- 保存到文件（支持 PNG/JPG/WebP）
- 直接贴图
- 上传到图床（可配置）

---

### 2.4 AI 助手

#### 2.4.1 支持的 AI 服务

| 服务商 | 模型 | 多模态支持 |
|--------|------|------------|
| OpenAI | GPT-4/GPT-4o/GPT-3.5 | ✅ |
| Anthropic | Claude 3.5/3 | ✅ |
| Google | Gemini Pro/Ultra | ✅ |
| Ollama | 本地模型 | 部分 |
| Azure OpenAI | 自定义部署 | ✅ |
| 自定义 | OpenAI 兼容接口 | - |

#### 2.4.2 使用方式

| 方式     | 说明                        |
| ------ | ------------------------- |
| 快速提问   | 主窗口输入 `ai 问题`             |
| 对话模式   | `Cmd/Ctrl+Shift+A` 打开对话窗口 |
| 截图提问   | 截图后选择"询问 AI"              |
| 剪贴板提问  | 剪贴板内容发送给 AI               |
| 选中文本提问 | 选中文本后快捷键发送给 AI            |

#### 2.4.3 预设 Prompt

用户可配置常用 Prompt 模板：
- 翻译（中英互译）
- 代码解释
- 文本润色
- 总结摘要
- 自定义模板

---

### 2.5 工作流自动化

#### 2.5.1 触发方式

| 触发类型 | 说明 | 示例 |
|----------|------|------|
| 关键词 | 在搜索框输入关键词触发 | `wf:deploy` |
| 快捷键 | 全局快捷键触发 | `Cmd+Shift+D` |
| 文件操作 | 打开特定类型文件时触发 | 打开 `.md` 文件 |
| 剪贴板 | 复制特定格式内容时触发 | 复制 URL |
| 定时 | 按 Cron 表达式定时触发 | 每天 9:00 |
| 手动 | 在工作流列表手动执行 | - |

#### 2.5.2 节点类型

**输入节点：**
- 文本输入
- 文件输入
- 剪贴板内容
- 选中文本
- 用户输入（弹窗）

**逻辑节点：**
- 条件判断
- 循环
- 延迟

**转换节点：**
- JSON 解析/序列化
- 正则提取/替换
- 文本转换（大小写、编码等）
- 模板渲染

**动作节点：**
- 打开 URL
- 打开文件/应用
- 运行 Shell 命令
- HTTP 请求
- 复制到剪贴板
- 发送通知
- 写入文件
- 显示对话框

**AI 节点：**
- AI 处理（使用 Prompt 模板）

**脚本节点：**
- JavaScript 脚本
- Python 脚本（需安装）

#### 2.5.3 工作流编辑器

- 可视化节点拖拽
- 节点连线
- 实时预览
- 调试运行
- 导入/导出

---

### 2.6 插件系统

#### 2.6.1 插件类型

| 类型 | 说明 |
|------|------|
| SearchProvider | 提供搜索结果 |
| ActionHandler | 处理特定动作 |
| WorkflowNode | 自定义工作流节点 |
| SystemEnhancement | 系统增强功能 |

#### 2.6.2 插件能力

- 注册自定义触发词
- 提供搜索结果
- 执行自定义动作
- 添加工作流节点
- 访问系统 API（需权限）

#### 2.6.3 插件权限

| 权限 | 说明 |
|------|------|
| Clipboard | 访问剪贴板 |
| FileSystem | 访问文件系统 |
| Network | 网络请求 |
| Notifications | 发送通知 |
| Shell | 执行命令 |
| SystemInfo | 读取系统信息 |

#### 2.6.4 插件市场

- 浏览推荐插件
- 搜索插件
- 一键安装/卸载
- 插件评分/评论
- 版本更新提示

---

## 三、配置中心

### 3.1 布局设计（参考 Alfred 5）

```
┌─────────────────────────────────────────────────────────────────────────┐
│                         OmniBox Preferences                              │
├──────────────────┬──────────────────────────────────────────────────────┤
│                  │                                                       │
│   ┌──────────┐   │                                                       │
│   │ General  │   │                  [选中分类的配置内容]                  │
│   ├──────────┤   │                                                       │
│   │ Features │   │                                                       │
│   ├──────────┤   │                                                       │
│   │Appearance│   │                                                       │
│   ├──────────┤   │                                                       │
│   │ Clipboard│   │                                                       │
│   ├──────────┤   │                                                       │
│   │Screenshot│   │                                                       │
│   ├──────────┤   │                                                       │
│   │   AI     │   │                                                       │
│   ├──────────┤   │                                                       │
│   │Workflows │   │                                                       │
│   ├──────────┤   │                                                       │
│   │ Plugins  │   │                                                       │
│   ├──────────┤   │                                                       │
│   │Web Search│   │                                                       │
│   ├──────────┤   │                                                       │
│   │ Advanced │   │                                                       │
│   ├──────────┤   │                                                       │
│   │  About   │   │                                                       │
│   └──────────┘   │                                                       │
│                  │                                                       │
└──────────────────┴──────────────────────────────────────────────────────┘
```

### 3.2 配置分类

#### 3.2.1 General（通用）

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| 开机启动 | 系统启动时自动运行 | ✅ |
| 主窗口快捷键 | 唤起主搜索窗口 | `Cmd/Alt+Space` |
| 语言 | 界面语言 | 系统语言 |
| 检查更新 | 自动检查更新 | ✅ |
| 显示托盘图标 | 系统托盘显示图标 | ✅ |

#### 3.2.2 Features（功能开关）

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| 文件搜索 | 启用文件搜索功能 | ✅ |
| 应用搜索 | 启用应用搜索功能 | ✅ |
| 计算器 | 启用计算器功能 | ✅ |
| Web 搜索 | 启用 Web 搜索功能 | ✅ |
| 剪贴板管理 | 启用剪贴板管理功能 | ✅ |
| 截图功能 | 启用截图功能 | ✅ |
| AI 助手 | 启用 AI 助手功能 | ✅ |

#### 3.2.3 Appearance（外观）

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| 主题 | 浅色/深色/跟随系统 | 跟随系统 |
| 强调色 | 主题强调色 | 蓝色 |
| 窗口宽度 | 搜索窗口宽度 | 680px |
| 结果数量 | 搜索结果显示数量 | 8 |
| 显示图标 | 结果列表显示图标 | ✅ |
| 模糊背景 | 窗口背景模糊效果 | ✅ |

#### 3.2.4 Clipboard（剪贴板）

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| 启用 | 启用剪贴板管理 | ✅ |
| 快捷键 | 唤起剪贴板窗口 | `Cmd/Ctrl+Shift+V` |
| 历史数量 | 最大历史记录数 | 1000 |
| 单条大小限制 | 单条记录最大尺寸 | 10MB |
| 保留天数 | 历史保留天数（0=永久） | 30 |
| 存储图片 | 是否存储图片类型 | ✅ |
| 忽略应用 | 忽略复制的应用列表 | [] |
| 敏感内容规则 | 敏感内容正则表达式 | [密码规则] |

#### 3.2.5 Screenshot（截图）

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| 区域截图快捷键 | 区域截图快捷键 | `Cmd/Ctrl+Shift+4` |
| 窗口截图快捷键 | 窗口截图快捷键 | `Cmd/Ctrl+Shift+5` |
| 快速贴图快捷键 | 快速贴图快捷键 | `Cmd/Ctrl+Shift+P` |
| 取色器快捷键 | 取色器快捷键 | `Cmd/Ctrl+Shift+C` |
| 默认保存路径 | 截图默认保存路径 | ~/Pictures/Screenshots |
| 默认格式 | 默认保存格式 | PNG |
| 图片质量 | JPEG 质量 | 90% |
| 截图音效 | 截图时播放音效 | ✅ |

#### 3.2.6 AI（AI 助手）

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| 默认服务商 | 默认 AI 服务商 | - |
| **服务商配置** | | |
| └ OpenAI API Key | OpenAI API 密钥 | - |
| └ OpenAI Model | 使用的模型 | gpt-4o |
| └ Anthropic API Key | Anthropic API 密钥 | - |
| └ Anthropic Model | 使用的模型 | claude-3-5-sonnet |
| └ Ollama Endpoint | 本地 Ollama 地址 | http://localhost:11434 |
| └ Custom Endpoint | 自定义 API 地址 | - |
| 保存对话 | 保存对话历史 | ✅ |
| 流式响应 | 启用流式输出 | ✅ |
| **预设 Prompt** | 可添加/编辑/删除 | |

#### 3.2.7 Workflows（工作流）

| 配置项 | 说明 |
|--------|------|
| 工作流列表 | 显示所有已创建的工作流 |
| 新建工作流 | 打开工作流编辑器 |
| 导入工作流 | 从文件导入工作流 |
| 导出工作流 | 导出工作流到文件 |

**工作流列表项：**
- 名称
- 描述
- 触发方式
- 启用/禁用开关
- 编辑/删除按钮

#### 3.2.8 Plugins（插件）

| 标签页 | 说明 |
|--------|------|
| Installed | 已安装插件列表 |
| Browse | 插件市场浏览 |

**已安装插件项：**
- 图标
- 名称
- 版本
- 描述
- 启用/禁用开关
- 设置按钮
- 卸载按钮

**插件市场项：**
- 图标
- 名称
- 作者
- 描述
- 下载量
- 评分
- 安装按钮

#### 3.2.9 Web Search（Web 搜索）

| 配置项 | 说明 |
|--------|------|
| 默认搜索引擎 | 直接回车时使用的搜索引擎 |
| 搜索引擎列表 | 所有可用搜索引擎 |
| 添加搜索引擎 | 添加自定义搜索引擎 |

**搜索引擎列表项：**
- 图标
- 名称
- 关键词
- URL 模板
- 内置/自定义标识
- 编辑/删除按钮

#### 3.2.10 Advanced（高级）

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| **文件索引** | | |
| └ 索引路径 | 索引的目录列表 | [~] |
| └ 排除路径 | 排除的目录列表 | [node_modules, .git] |
| └ 排除模式 | 排除的 glob 模式 | [*.log, *.tmp] |
| └ 索引深度 | 最大目录深度 | 无限制 |
| └ 索引隐藏文件 | 是否索引隐藏文件 | ❌ |
| └ 实时监听 | 监听文件变化实时更新 | ✅ |
| └ 重建索引 | 手动重建索引按钮 | - |
| **数据** | | |
| └ 数据目录 | 应用数据存储位置 | 显示路径 |
| └ 打开数据目录 | 在文件管理器中打开 | - |
| └ 导出数据 | 导出所有配置和数据 | - |
| └ 导入数据 | 导入配置和数据 | - |
| └ 重置设置 | 恢复默认设置 | - |
| **日志** | | |
| └ 日志级别 | Debug/Info/Warn/Error | Info |
| └ 打开日志 | 查看应用日志 | - |

#### 3.2.11 About（关于）

| 信息 | 说明 |
|------|------|
| 应用名称 | OmniBox |
| 版本号 | v1.0.0 |
| 构建信息 | 构建时间、Commit ID |
| 检查更新 | 手动检查更新按钮 |
| 开源协议 | MIT License |
| GitHub | 项目仓库链接 |
| 反馈问题 | Issue 页面链接 |
| 致谢 | 使用的开源项目列表 |

---

## 四、快捷键汇总

### 4.1 全局快捷键（可自定义）

| 功能 | macOS 默认 | Windows 默认 |
|------|------------|--------------|
| 主搜索窗口 | `Cmd+Space` | `Alt+Space` |
| 剪贴板历史 | `Cmd+Shift+V` | `Ctrl+Shift+V` |
| 区域截图 | `Cmd+Shift+4` | `Ctrl+Shift+S` |
| 窗口截图 | `Cmd+Shift+5` | `Ctrl+Shift+W` |
| 快速贴图 | `Cmd+Shift+P` | `Ctrl+Shift+P` |
| 取色器 | `Cmd+Shift+C` | `Ctrl+Shift+C` |
| AI 对话 | `Cmd+Shift+A` | `Ctrl+Shift+A` |

### 4.2 主窗口内快捷键

| 快捷键 | 功能 |
|--------|------|
| `↑/↓` | 上下选择结果 |
| `Enter` | 执行选中项 |
| `Cmd/Ctrl+Enter` | 在文件管理器中显示 |
| `Cmd/Ctrl+C` | 复制选中项路径/内容 |
| `Tab` | 自动补全/进入子菜单 |
| `Esc` | 清空/关闭窗口 |
| `Cmd/Ctrl+,` | 打开设置 |
| `Cmd/Ctrl+1-9` | 快速选择第 N 个结果 |

### 4.3 剪贴板窗口快捷键

| 快捷键 | 功能 |
|--------|------|
| `↑/↓` | 上下选择 |
| `1-9` | 快速选择并粘贴 |
| `Enter` | 粘贴选中项 |
| `Cmd/Ctrl+Delete` | 删除选中项 |
| `Cmd/Ctrl+S` | 收藏/取消收藏 |
| `Esc` | 关闭窗口 |

### 4.4 截图编辑器快捷键

| 快捷键 | 功能 |
|--------|------|
| `R` | 矩形工具 |
| `E` | 椭圆工具 |
| `A` | 箭头工具 |
| `L` | 直线工具 |
| `P` | 画笔工具 |
| `T` | 文字工具 |
| `M` | 马赛克工具 |
| `N` | 序号工具 |
| `Cmd/Ctrl+Z` | 撤销 |
| `Cmd/Ctrl+Shift+Z` | 重做 |
| `Cmd/Ctrl+C` | 复制到剪贴板 |
| `Cmd/Ctrl+S` | 保存到文件 |
| `Enter` | 确认（复制并关闭） |
| `Esc` | 取消 |

---

## 五、数据存储

### 5.1 存储位置

| 平台      | 路径                                       |
| ------- | ---------------------------------------- |
| macOS   | `~/Library/Application Support/OmniBox/` |
| Windows | `%APPDATA%/OmniBox/`                     |

### 5.2 目录结构

```
OmniBox/
├── config.yaml          # 应用配置
├── omnibox.db           # SQLite 数据库（加密）
├── plugins/             # 插件目录
│   └── {plugin-id}/
├── workflows/           # 工作流定义
│   └── {workflow-id}.json
├── screenshots/         # 截图临时存储
├── cache/               # 缓存目录
│   ├── icons/          # 应用图标缓存
│   └── index/          # 索引缓存
└── logs/                # 日志目录
    └── omnibox.log
```

### 5.3 数据库表结构

| 表名                  | 说明      |
| ------------------- | ------- |
| `file_index`        | 文件索引    |
| `clipboard_history` | 剪贴板历史   |
| `app_usage`         | 应用使用统计  |
| `search_history`    | 搜索历史    |
| `ai_conversations`  | AI 对话历史 |
| `plugin_data`       | 插件数据存储  |

---

## 六、技术要求

### 6.1 技术栈

| 组件 | 技术选型 |
|------|----------|
| 框架 | Tauri 2.0 |
| 后端 | Rust |
| 前端 | SolidJS + TypeScript |
| 样式 | TailwindCSS |
| 构建 | Vite |
| 数据库 | SQLite + SQLCipher |
| 异步 | Tokio |

### 6.2 性能指标

| 指标 | 目标值 |
|------|--------|
| 冷启动时间 | < 500ms |
| 热启动时间 | < 100ms |
| 搜索响应时间 | < 50ms |
| 内存占用（空闲） | < 50MB |
| 内存占用（活跃） | < 150MB |
| 安装包大小 | < 20MB |

### 6.3 兼容性

| 平台 | 最低版本 |
|------|----------|
| macOS | 11.0 (Big Sur) |
| Windows | 10 (1903+) |

---

## 七、里程碑规划

### Phase 1: MVP（v0.1）
- [x] 项目初始化
- [ ] 主窗口 UI
- [ ] 基础文件搜索
- [ ] 应用搜索与启动
- [ ] 计算器

### Phase 2: 核心功能（v0.5）
- [ ] 文件索引引擎
- [ ] 剪贴板管理（独立窗口）
- [ ] Web 搜索
- [ ] 基础配置中心

### Phase 3: 高级功能（v0.8）
- [ ] 截图与标注
- [ ] 贴图功能
- [ ] AI 集成
- [ ] 完整配置中心

### Phase 4: 扩展能力（v1.0）
- [ ] 工作流系统
- [ ] 插件系统
- [ ] 插件市场
- [ ] 数据同步（可选）

---

## 八、附录

### 8.1 参考产品

- Alfred 5 (macOS)
- Raycast (macOS)
- uTools (跨平台)
- Ditto (Windows 剪贴板)
- Snipaste (截图贴图)
- Listary (Windows)

### 8.2 术语表

| 术语 | 说明 |
|------|------|
| 触发词 | 用于激活特定功能的前缀关键词 |
| 工作流 | 由多个节点组成的自动化流程 |
| 贴图 | 将截图悬浮显示在屏幕上 |
| Provider | AI 服务提供商 |